<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:LANCommander.Launcher.Avalonia.ViewModels.Components"
             xmlns:converters="using:LANCommander.Launcher.Avalonia.Converters"
             x:Class="LANCommander.Launcher.Avalonia.Views.Components.LibrarySidebarView"
             x:DataType="vm:LibrarySidebarViewModel">
    
    <UserControl.Resources>
        <converters:FilePathToBitmapConverter x:Key="FilePathToBitmapConverter" />
    </UserControl.Resources>
    
    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
        <DockPanel>
            <!-- Header -->
            <Border DockPanel.Dock="Top" Padding="16" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                <DockPanel>
                    <Button DockPanel.Dock="Right" 
                            Content="âŸ³" 
                            Command="{Binding RefreshCommand}"
                            ToolTip.Tip="Refresh"
                            Padding="8,4" />
                    <TextBlock Text="LANCommander" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               VerticalAlignment="Center" />
                </DockPanel>
            </Border>
            
            <!-- Navigation Buttons -->
            <StackPanel DockPanel.Dock="Top" Margin="8,8,8,0">
                <Button Command="{Binding ShowDepotCommand}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        Padding="12,10"
                        Margin="0,0,0,4"
                        Classes.selected="{Binding IsDepotSelected}">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="ðŸª" FontSize="16" />
                        <TextBlock Text="Depot (All Games)" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
            </StackPanel>
            
            <!-- Library Section Header -->
            <Border DockPanel.Dock="Top" Padding="16,16,16,8">
                <TextBlock Text="MY LIBRARY" 
                           FontSize="11" 
                           FontWeight="SemiBold" 
                           Opacity="0.5" />
            </Border>
            
            <!-- Footer -->
            <Border DockPanel.Dock="Bottom" Padding="8" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="4">
                        <Button Content="âš™"
                                Command="{Binding SettingsCommand}"
                                ToolTip.Tip="Settings"
                                Padding="8,4" />
                        <Button Content="Logout"
                                Command="{Binding LogoutCommand}"
                                Padding="8,4" />
                    </StackPanel>
                    <TextBlock Text="{Binding StatusMessage}" 
                               Opacity="0.6" 
                               FontSize="11"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis" />
                </DockPanel>
            </Border>
            
            <!-- Loading Indicator -->
            <Border DockPanel.Dock="Top" 
                    IsVisible="{Binding IsLoading}"
                    Padding="16,8">
                <TextBlock Text="Loading..." Opacity="0.6" FontSize="12" />
            </Border>
            
            <!-- Library Items List -->
            <ListBox ItemsSource="{Binding Items}"
                     SelectedItem="{Binding SelectedItem}"
                     Padding="4"
                     Background="Transparent">
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="vm:LibraryItemViewModel">
                        <Button Command="{Binding $parent[ListBox].((vm:LibrarySidebarViewModel)DataContext).SelectItemCommand}"
                                CommandParameter="{Binding}"
                                Background="Transparent"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Cursor="Hand">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <!-- Icon -->
                                <Border Width="24" Height="24" 
                                        CornerRadius="4" 
                                        ClipToBounds="True">
                                    <Panel>
                                        <Image Source="{Binding IconPath, Converter={StaticResource FilePathToBitmapConverter}}"
                                               Stretch="UniformToFill"
                                               IsVisible="{Binding HasIcon}" />
                                        <Border Background="{DynamicResource SystemAccentColor}"
                                                IsVisible="{Binding !HasIcon}">
                                            <TextBlock Text="ðŸŽ®" 
                                                       FontSize="12" 
                                                       HorizontalAlignment="Center" 
                                                       VerticalAlignment="Center" />
                                        </Border>
                                    </Panel>
                                </Border>
                                
                                <!-- Title -->
                                <TextBlock Text="{Binding Title}" 
                                           VerticalAlignment="Center"
                                           TextTrimming="CharacterEllipsis" />
                            </StackPanel>
                        </Button>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </DockPanel>
    </Border>
</UserControl>
