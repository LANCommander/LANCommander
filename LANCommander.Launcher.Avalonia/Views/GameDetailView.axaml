<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:LANCommander.Launcher.Avalonia.ViewModels"
             xmlns:converters="using:LANCommander.Launcher.Avalonia.Converters"
             x:Class="LANCommander.Launcher.Avalonia.Views.GameDetailView"
             x:DataType="vm:GameDetailViewModel">
    
    <UserControl.Resources>
        <converters:FilePathToBitmapConverter x:Key="FilePathToBitmapConverter" />
    </UserControl.Resources>
    
    <Grid RowDefinitions="Auto,*">
        <!-- Header with Back Button -->
        <Border Grid.Row="0" Padding="16" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
            <DockPanel>
                <Button DockPanel.Dock="Left" 
                        Content="â† Back to Depot" 
                        Command="{Binding GoBackCommand}"
                        Padding="12,8" />
                <TextBlock Text="{Binding Title}" 
                           FontSize="20" 
                           FontWeight="Bold" 
                           VerticalAlignment="Center"
                           Margin="16,0,0,0" />
            </DockPanel>
        </Border>
        
        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Disabled">
            <Grid RowDefinitions="Auto,*">
                <!-- Banner/Cover Image -->
                <Border Grid.Row="0" 
                        Height="300" 
                        Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                    <Panel>
                        <!-- Background image (if available) -->
                        <Image Source="{Binding BackgroundPath, Converter={StaticResource FilePathToBitmapConverter}}"
                               Stretch="UniformToFill"
                               Opacity="0.3"
                               IsVisible="{Binding BackgroundPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                        
                        <!-- Cover/Banner overlay -->
                        <Border HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                CornerRadius="8"
                                ClipToBounds="True"
                                MaxHeight="280"
                                BoxShadow="0 4 16 0 #40000000">
                            <Image Source="{Binding BannerPath, Converter={StaticResource FilePathToBitmapConverter}}"
                                   Stretch="Uniform"
                                   MaxHeight="280"
                                   IsVisible="{Binding BannerPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                        </Border>
                        
                        <!-- Fallback when no banner -->
                        <Border HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                Background="{DynamicResource SystemAccentColor}"
                                CornerRadius="8"
                                Padding="40,20"
                                IsVisible="{Binding BannerPath, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                            <StackPanel>
                                <TextBlock Text="ðŸŽ®" FontSize="48" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding Title}" 
                                           FontSize="24" 
                                           FontWeight="Bold" 
                                           HorizontalAlignment="Center"
                                           Foreground="White" />
                            </StackPanel>
                        </Border>
                    </Panel>
                </Border>
                
                <!-- Game Details -->
                <StackPanel Grid.Row="1" Margin="24" Spacing="16">
                    <!-- Title and Year -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="28" 
                                   FontWeight="Bold" />
                        <TextBlock Text="{Binding ReleaseYear}" 
                                   FontSize="16" 
                                   Opacity="0.7" />
                    </StackPanel>
                    
                    <!-- Quick Info Cards -->
                    <WrapPanel Orientation="Horizontal">
                        <!-- Developers -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding Developers, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ‘¨â€ðŸ’»" />
                                <TextBlock Text="{Binding Developers}" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Publishers -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding Publishers, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ¢" />
                                <TextBlock Text="{Binding Publishers}" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Singleplayer -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding Singleplayer}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ‘¤" />
                                <TextBlock Text="Singleplayer" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Multiplayer -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding HasMultiplayer}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ‘¥" />
                                <TextBlock Text="{Binding MultiplayerModes}" />
                            </StackPanel>
                        </Border>
                    </WrapPanel>
                    
                    <!-- Genres -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Genres, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Genres" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Genres}" TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Platforms -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Platforms, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Platforms" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Platforms}" TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Tags -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Tags, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Tags" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Tags}" TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Description -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Description" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Description}" 
                                   TextWrapping="Wrap" 
                                   LineHeight="24" />
                    </StackPanel>
                    
                    <!-- Library Section -->
                    <Border Margin="0,16,0,0" 
                            Padding="16" 
                            CornerRadius="8"
                            Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                        <StackPanel Spacing="12">
                            <TextBlock Text="Library" FontWeight="SemiBold" FontSize="16" />
                            
                            <!-- Status message -->
                            <TextBlock Text="{Binding StatusMessage}" 
                                       Opacity="0.7"
                                       IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                            
                            <!-- Add to Library button (shown when not in library) -->
                            <Button Command="{Binding AddToLibraryCommand}"
                                    IsVisible="{Binding !IsInLibrary}"
                                    IsEnabled="{Binding !IsAddingToLibrary}"
                                    HorizontalAlignment="Left"
                                    Padding="16,10">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="+" FontWeight="Bold" IsVisible="{Binding !IsAddingToLibrary}" />
                                    <TextBlock Text="Add to Library" IsVisible="{Binding !IsAddingToLibrary}" />
                                    <TextBlock Text="Adding..." IsVisible="{Binding IsAddingToLibrary}" />
                                </StackPanel>
                            </Button>
                            
                            <!-- In Library indicator + Remove button (shown when in library) -->
                            <StackPanel Orientation="Horizontal" Spacing="12" IsVisible="{Binding IsInLibrary}">
                                <Border Background="{DynamicResource SystemAccentColor}"
                                        CornerRadius="4"
                                        Padding="12,8">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="âœ“" Foreground="White" />
                                        <TextBlock Text="In Library" Foreground="White" />
                                    </StackPanel>
                                </Border>
                                
                                <Button Command="{Binding RemoveFromLibraryCommand}"
                                        IsEnabled="{Binding !IsRemovingFromLibrary}"
                                        Padding="12,8">
                                    <Panel>
                                        <TextBlock Text="Remove from Library" Foreground="IndianRed" IsVisible="{Binding !IsRemovingFromLibrary}" />
                                        <TextBlock Text="Removing..." Foreground="IndianRed" IsVisible="{Binding IsRemovingFromLibrary}" />
                                    </Panel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Install Section -->
                    <Border Margin="0,8,0,0" 
                            Padding="16" 
                            CornerRadius="8"
                            Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                        <StackPanel Spacing="12">
                            <TextBlock Text="Installation" FontWeight="SemiBold" FontSize="16" />
                            
                            <!-- Installed indicator -->
                            <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsInstalled}">
                                <TextBlock Text="âœ“" Foreground="Green" />
                                <TextBlock Text="Installed" />
                            </StackPanel>
                            
                            <!-- Install button (shown when not installed) -->
                            <Button Command="{Binding InstallCommand}"
                                    IsVisible="{Binding !IsInstalled}"
                                    IsEnabled="{Binding !IsInstalling}"
                                    HorizontalAlignment="Left"
                                    Padding="20,12"
                                    Classes="accent">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="â¬‡" FontWeight="Bold" IsVisible="{Binding !IsInstalling}" />
                                    <TextBlock Text="Install" FontWeight="SemiBold" IsVisible="{Binding !IsInstalling}" />
                                    <TextBlock Text="Starting..." IsVisible="{Binding IsInstalling}" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
