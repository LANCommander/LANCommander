<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:LANCommander.Launcher.Avalonia.ViewModels"
             xmlns:converters="using:LANCommander.Launcher.Avalonia.Converters"
             x:Class="LANCommander.Launcher.Avalonia.Views.GameDetailView"
             x:DataType="vm:GameDetailViewModel">
    
    <UserControl.Resources>
        <converters:FilePathToBitmapConverter x:Key="FilePathToBitmapConverter" />
    </UserControl.Resources>
    
    <Grid RowDefinitions="Auto,*">
        <!-- Header with Back Button -->
        <Border Grid.Row="0" Padding="16" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
            <DockPanel>
                <Button DockPanel.Dock="Left" 
                        Content="â† Back to Depot" 
                        Command="{Binding GoBackCommand}"
                        Padding="12,8" />
                <TextBlock Text="{Binding Title}" 
                           FontSize="20" 
                           FontWeight="Bold" 
                           VerticalAlignment="Center"
                           Margin="16,0,0,0" />
            </DockPanel>
        </Border>
        
        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Disabled">
            <Grid RowDefinitions="Auto,*">
                <!-- Banner/Cover Image -->
                <Border Grid.Row="0" 
                        Height="300" 
                        Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                    <Panel>
                        <!-- Background image (if available) -->
                        <Image Source="{Binding BackgroundPath, Converter={StaticResource FilePathToBitmapConverter}}"
                               Stretch="UniformToFill"
                               Opacity="0.3"
                               IsVisible="{Binding BackgroundPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                        
                        <!-- Cover/Banner overlay -->
                        <Border HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                CornerRadius="8"
                                ClipToBounds="True"
                                MaxHeight="280"
                                BoxShadow="0 4 16 0 #40000000">
                            <Image Source="{Binding BannerPath, Converter={StaticResource FilePathToBitmapConverter}}"
                                   Stretch="Uniform"
                                   MaxHeight="280"
                                   IsVisible="{Binding BannerPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                        </Border>
                        
                        <!-- Fallback when no banner -->
                        <Border HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                Background="{DynamicResource SystemAccentColor}"
                                CornerRadius="8"
                                Padding="40,20"
                                IsVisible="{Binding BannerPath, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                            <StackPanel>
                                <TextBlock Text="ðŸŽ®" FontSize="48" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding Title}" 
                                           FontSize="24" 
                                           FontWeight="Bold" 
                                           HorizontalAlignment="Center"
                                           Foreground="White" />
                            </StackPanel>
                        </Border>
                    </Panel>
                </Border>
                
                <!-- Game Details -->
                <StackPanel Grid.Row="1" Margin="24" Spacing="16">
                    <!-- Title and Year -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="28" 
                                   FontWeight="Bold" />
                        <TextBlock Text="{Binding ReleaseYear}" 
                                   FontSize="16" 
                                   Opacity="0.7" />
                    </StackPanel>
                    
                    <!-- Quick Info Cards -->
                    <WrapPanel Orientation="Horizontal">
                        <!-- Developers -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding Developers, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ‘¨â€ðŸ’»" />
                                <TextBlock Text="{Binding Developers}" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Publishers -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding Publishers, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ¢" />
                                <TextBlock Text="{Binding Publishers}" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Singleplayer -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding Singleplayer}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ‘¤" />
                                <TextBlock Text="Singleplayer" />
                            </StackPanel>
                        </Border>
                        
                        <!-- Multiplayer -->
                        <Border Margin="0,0,8,8" 
                                Padding="12,8" 
                                CornerRadius="4"
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                IsVisible="{Binding HasMultiplayer}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="ðŸ‘¥" />
                                <TextBlock Text="{Binding MultiplayerModes}" />
                            </StackPanel>
                        </Border>
                    </WrapPanel>
                    
                    <!-- Genres -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Genres, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Genres" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Genres}" TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Platforms -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Platforms, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Platforms" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Platforms}" TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Tags -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Tags, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Tags" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Tags}" TextWrapping="Wrap" />
                    </StackPanel>
                    
                    <!-- Description -->
                    <StackPanel Spacing="8" 
                                IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Description" FontWeight="SemiBold" FontSize="14" Opacity="0.7" />
                        <TextBlock Text="{Binding Description}" 
                                   TextWrapping="Wrap" 
                                   LineHeight="24" />
                    </StackPanel>
                    
                    <!-- Game Action Bar -->
                    <Border Margin="0,16,0,0" 
                            Padding="16" 
                            CornerRadius="8"
                            Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                        <StackPanel Spacing="16">
                            <!-- Status message -->
                            <TextBlock Text="{Binding StatusMessage}" 
                                       Foreground="{DynamicResource SystemAccentColor}"
                                       IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                            
                            <!-- Primary Action Row -->
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <!-- Play button (installed, not running) -->
                                <Button Command="{Binding PlayCommand}"
                                        IsVisible="{Binding IsInstalled}"
                                        IsEnabled="{Binding !IsStarting}"
                                        Padding="24,14"
                                        Classes="accent"
                                        FontSize="16">
                                    <Panel>
                                        <!-- Normal state -->
                                        <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding !IsRunning}">
                                            <TextBlock Text="â–¶" FontWeight="Bold" IsVisible="{Binding !IsStarting}" />
                                            <TextBlock Text="Play" FontWeight="SemiBold" IsVisible="{Binding !IsStarting}" />
                                            <TextBlock Text="Starting..." IsVisible="{Binding IsStarting}" />
                                        </StackPanel>
                                        
                                        <!-- Running state - shown as indicator, clicking stops -->
                                        <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsRunning}">
                                            <TextBlock Text="â¹" FontWeight="Bold" IsVisible="{Binding !IsStopping}" />
                                            <TextBlock Text="Running" FontWeight="SemiBold" IsVisible="{Binding !IsStopping}" />
                                            <TextBlock Text="Stopping..." IsVisible="{Binding IsStopping}" />
                                        </StackPanel>
                                    </Panel>
                                </Button>
                                
                                <!-- Stop button (when running) -->
                                <Button Command="{Binding StopCommand}"
                                        IsVisible="{Binding IsRunning}"
                                        IsEnabled="{Binding !IsStopping}"
                                        Padding="16,14"
                                        Foreground="IndianRed">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="â¹" />
                                        <TextBlock Text="Stop" />
                                    </StackPanel>
                                </Button>
                                
                                <!-- Install button (not installed) -->
                                <Button Command="{Binding InstallCommand}"
                                        IsVisible="{Binding !IsInstalled}"
                                        IsEnabled="{Binding !IsInstalling}"
                                        Padding="24,14"
                                        Classes="accent"
                                        FontSize="16">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="â¬‡" FontWeight="Bold" IsVisible="{Binding !IsInstalling}" />
                                        <TextBlock Text="Install" FontWeight="SemiBold" IsVisible="{Binding !IsInstalling}" />
                                        <TextBlock Text="Installing..." IsVisible="{Binding IsInstalling}" />
                                    </StackPanel>
                                </Button>
                                
                                <!-- More actions dropdown placeholder -->
                                <Button Command="{Binding BrowseFilesCommand}"
                                        IsVisible="{Binding IsInstalled}"
                                        Padding="12,14"
                                        ToolTip.Tip="Browse Files">
                                    <TextBlock Text="ðŸ“" />
                                </Button>
                            </StackPanel>
                            
                            <!-- Stats Row -->
                            <StackPanel Orientation="Horizontal" Spacing="32">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Play Time" FontSize="11" Opacity="0.6" />
                                    <TextBlock Text="{Binding PlayTime}" FontSize="14" FontWeight="SemiBold" />
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Last Played" FontSize="11" Opacity="0.6" />
                                    <TextBlock Text="{Binding LastPlayed}" FontSize="14" FontWeight="SemiBold" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Library Management -->
                    <Border Margin="0,8,0,0" 
                            Padding="16" 
                            CornerRadius="8"
                            Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                        <StackPanel Spacing="12">
                            <TextBlock Text="Library" FontWeight="SemiBold" FontSize="14" Opacity="0.8" />
                            
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <!-- Add to Library (not in library) -->
                                <Button Command="{Binding AddToLibraryCommand}"
                                        IsVisible="{Binding !IsInLibrary}"
                                        IsEnabled="{Binding !IsAddingToLibrary}"
                                        Padding="12,8">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="+" FontWeight="Bold" IsVisible="{Binding !IsAddingToLibrary}" />
                                        <TextBlock Text="Add to Library" IsVisible="{Binding !IsAddingToLibrary}" />
                                        <TextBlock Text="Adding..." IsVisible="{Binding IsAddingToLibrary}" />
                                    </StackPanel>
                                </Button>
                                
                                <!-- In Library badge -->
                                <Border Background="{DynamicResource SystemAccentColor}"
                                        CornerRadius="4"
                                        Padding="12,8"
                                        IsVisible="{Binding IsInLibrary}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="âœ“" Foreground="White" />
                                        <TextBlock Text="In Library" Foreground="White" />
                                    </StackPanel>
                                </Border>
                                
                                <!-- Remove from Library -->
                                <Button Command="{Binding RemoveFromLibraryCommand}"
                                        IsVisible="{Binding IsInLibrary}"
                                        IsEnabled="{Binding !IsRemovingFromLibrary}"
                                        Padding="12,8">
                                    <Panel>
                                        <TextBlock Text="Remove" Foreground="IndianRed" IsVisible="{Binding !IsRemovingFromLibrary}" />
                                        <TextBlock Text="Removing..." Foreground="IndianRed" IsVisible="{Binding IsRemovingFromLibrary}" />
                                    </Panel>
                                </Button>
                                
                                <!-- Uninstall (when installed) -->
                                <Button Command="{Binding UninstallCommand}"
                                        IsVisible="{Binding IsInstalled}"
                                        IsEnabled="{Binding !IsUninstalling}"
                                        Padding="12,8">
                                    <Panel>
                                        <TextBlock Text="Uninstall" Foreground="IndianRed" IsVisible="{Binding !IsUninstalling}" />
                                        <TextBlock Text="Uninstalling..." Foreground="IndianRed" IsVisible="{Binding IsUninstalling}" />
                                    </Panel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
