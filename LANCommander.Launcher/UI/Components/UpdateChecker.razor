@using LANCommander.SDK.Models
@using Semver
@namespace LANCommander.Launcher.UI
@inject UpdateService UpdateService
@inject ModalService ModalService
@inject LocalizationService LocalizationService

@code {
    protected override async Task OnInitializedAsync()
    {
        UpdateService.OnUpdateAvailable += OnUpdateAvailable;
    }

    async Task OnUpdateAvailable(CheckForUpdateResponse response)
    {
        var confirmUpdate = await ModalService.ConfirmAsync(new ConfirmOptions
        {
            OkText = LocalizationService.GetString("UpdateNow"),
            CancelText = LocalizationService.GetString("Later"),
            Title = LocalizationService.GetString("LauncherUpdate"),
            Content = LocalizationService.GetString("UpdateAvailableMessage", response.Version),
            Centered = true
        });

        if (confirmUpdate && SemVersion.TryParse(response.Version, SemVersionStyles.Any, out var version))
        {
            await UpdateService.UpdateAsync(version);
        }
    }
}
